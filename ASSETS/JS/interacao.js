
let vetorFilmes = [{id: 0,
        titulo: "Star Trek: Além da Escuridão",
        nota: "77% - Avaliação dos Usuários",
        resenha: "Em 2259, a nave estelar USS Enterprise estudava uma cultura primitiva do planeta Nibiru, quando o capitão James T. Kirk resolveu deter um vulcão em erupção que ameaçava destruir tudo. Na ação, ele desrespeita a Primeira Diretriz da Frota Estelar para salvar Spock. Por causa disso, é julgado e perde o comando da nave para o Almirante Christopher Pike que, contudo, consegue colocá-lo como seu Imediato. Logo em seguida ficam sabendo da ameaça terrorista representada pelo renegado John Harrison, que após realizar um atentado em Londres, foge para o planeta natal dos Klingon, Kronos. A Enterprise parte para lá para capturar o bandido, sabendo que essa investida poderá representar a guerra contra aquele povo guerreiro. Além disso, Harrison se revelará como o super-humano aperfeiçoado geneticamente, Khan.",
        url: "https://encrypted-tbn1.gstatic.com/images?q=tbn:ANd9GcT7v3WHoEBxdOSPQ8WCo0W9CV1tWrXC0xGn4kVxTE2r-mJBbvN8",
        categoria: "sugestoes"}, 
        
        {id: 1,
        titulo: "Zootopia 2",
        nota: "77% - Avaliação dos Usuários",
        resenha: "Os detetives Judy Hopps e Nick Wilde se encontram na trilha sinuosa de um réptil misterioso que chega a Zootopia e vira a metrópole dos mamíferos de cabeça para baixo.",
        url: "https://www.themoviedb.org/t/p/w1280/fthvYnjERbXt3ILjLjHpPNd5IVJ.jpg",
        categoria: "sugestoes"},
        
        {id: 2,
        titulo: "Wicked",
        nota: "67% - Avaliação dos Usuários",
        resenha: "Elphaba é uma jovem como outra qualquer do Reino de Oz, mas incompreendida por causa de sua pele verde incomum e por ainda não ter descoberto seu verdadeiro poder. Sua rotina é tranquila e pouco interessante, mas ao iniciar seus estudos na Universidade de Shiz, seu destino encontra Glinda, uma jovem popular e ambiciosa, nascida em berço de ouro, que só quer garantir seus privilégios e ainda não conhece sua verdadeira alma. As duas iniciam uma inesperada amizade; no entanto, suas diferenças, como o desejo de Glinda pela popularidade e poder, e a determinação de Elphaba em permanecer fiel a si mesma, entram no caminho, o que pode perpetuar no futuro de cada uma e em como as pessoas de Oz as enxergam.",
        url: "https://image.tmdb.org/t/p/w1280/qcaKkLwIXCAxJtpetVYHniCvLZj.jpg",
        categoria: "sugestoes"},
        
        {id: 3,
        titulo: "Star Wsrs: Episódio IV - Uma Nova Esperança",
        nota: "91% - Avaliação dos Usuários",
        resenha: "A princesa Leia é mantida refém pelas forças imperiais comandadas por Darth Vader. Luke Skywalker e o capitão Han Solo precisam libertá-la e restaurar a liberdade e a justiça na galáxia.",
        url: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSBBTGgVQq5SADx7QduQTcJZnNO2I9qHUD0iTavGzrb5Piy9PyOig0xSBuHGhBsgIT8xNs_sw&s=10",
        categoria: "sugestoes"},
        
        {id: 4,
        titulo: "Matrix - 1999",
        nota: "86% - Avaliação dos Usuários",
        resenha: "Um hacker aprende com os misteriosos rebeldes sobre a verdadeira natureza de sua realidade e seu papel na guerra contra seus controladores.",
        url: "https://m.media-amazon.com/images/M/MV5BN2NmN2VhMTQtMDNiOS00NDlhLTliMjgtODE2ZTY0ODQyNDRhXkEyXkFqcGc@._V1_.jpg",
        categoria: "sugestoes"}, 
        
        {id: 5,
        titulo: "Superman - 2025",
        nota: "79% - Avaliação dos Usuários",
        resenha: "Superman, um jovem repórter de Metrópolis, embarca em uma jornada para reconciliar sua herança kryptoniana com sua criação humana como Clark Kent.",
        url: "https://www.themoviedb.org/t/p/w1280/xeZ8oG6W60fEPf9yCjERUXiHRBF.jpg",
        categoria: "sugestoes"}, 
        
        {id: 6,
        titulo: "Lego: Batman - O Filme",
        nota: "72% - Avaliação dos Usuários",
        resenha: "No spin-off de Uma Aventura Lego, Batman (Will Arnett) descobre que adotou acidentalmente um garoto órfão. Ele se torna ninguém menos que seu ajudante Robin (Michael Cera). A dupla formada pelo arrogante Homem-Morcego e o seu empolgado ajudante deve combater o crime e prender o Coringa (Zach Galifianakis).",
        url: "https://www.themoviedb.org/t/p/w1280/jUZAAKHfHwZj8bEvghaY9MrGCRG.jpg",
        categoria: "sugestoes"},

          {id: 7,
        titulo: "Vingadores Ultimato",
        nota: "85% - Avaliação dos Usuários",
        resenha: "Após Thanos dizimar metade da vida no universo, os heróis sobreviventes, liderados por Capitão América e Viúva Negra, se reúnem para tentar reverter o dano. Eles conseguem viajar no tempo para coletar as Joias do Infinito de diferentes épocas, mas o plano é descoberto por uma versão passada de Thanos. O confronto final ocorre no presente, com um sacrifício de um dos Vingadores que salva o universo, mas não sem perdas significativas. " ,
        url: "https://image.tmdb.org/t/p/w600_and_h900_face/9fRX8UKlIW7Lb9GqNsJVakWWFCi.jpg",
        categoria: "sugestoes" },

        {id: 8,
        titulo: "Indiana Jones e A Relíquia do Destino",
        nota: "65% - Avaliação dos Usuários",
        resenha: "Encontrando-se em uma nova era, aproximando-se da aposentadoria, Indy luta para se encaixar em um mundo que parece tê-lo superado. Mas quando os tentáculos de um mal muito familiar retornam na forma de um antigo rival, Indy deve colocar seu chapéu e pegar seu chicote mais uma vez para garantir que um antigo e poderoso artefato não caia nas mãos erradas.",
        url: "https://image.tmdb.org/t/p/w600_and_h900_face/2vTsUU93ZHJlvpQukmvIWABD3HL.jpg",
        categoria: "sugestoes" },

         {id: 9,
        titulo: "Rambo IV ",
        nota: "87% - Avaliação dos Usuários",
        resenha: "John Rambo se recolheu no norte da Tailândia, onde pilota um barco no Rio Salween. Na fronteira com a Birmânia, a mais longa guerra civil acontece entre birmaneses e a tribo Karen, um conflito de quase 60 anos. Mas Rambo tem uma vida simples e solitária nas montanhas e selvas e há muito tempo desistiu de lutar. Até que um grupo de missionários de direitos humanos o procura pedindo sua ajuda. O grupo logo é capturado e um pastor contrata um grupo de mercenários para resgatá-los. Apesar de ter sido um soldado treinado para matar, Rambo reluta em se envolver em conflitos violentos após tanto tempo. Suas feridas cicatrizaram, mas ainda estão visíveis.",
        url: "https://image.tmdb.org/t/p/w600_and_h900_face/2NbmBzgG1chI3fS31HHfZEEsApw.jpg",
        categoria: "sugestoes" },

          {id: 10,
        titulo: "007 Cassino Royale ",
        nota: "76% - Avaliação dos Usuários",
        resenha: "Depois de obter o status 00 e uma licença para matar, o agente secreto James Bond parte em sua primeira missão como 007. Bond precisa derrotar um banqueiro privado que financia terroristas em um jogo de pôquer de alto risco no Casino Royale, Montenegro.",
        url: "https://image.tmdb.org/t/p/w600_and_h900_face/7b3qmLlvm2lvJ2gxsKQ42S3RTKR.jpg",
        categoria: "sugestoes" },
     ];

document.addEventListener("DOMContentLoaded", function () {
    carregarFilmes();
});

let inputNomeEl = document.querySelector('#input-nome-filme');
let inputNotaEl = document.querySelector('#input-nota-filme');
let inputResenhaEl = document.querySelector('#input-resenha-filme');
let inputURLEl = document.querySelector('#input-url-filme');
let inputCategoriaEl = document.querySelector('#input-categoria-filme');
let categoriaFavoritos = document.querySelector('#filmes-favoritos');
let categoriaAcao = document.querySelector('#filmes-acao');
let categoriaComedia = document.querySelector('#filmes-comedia');
let categoriaAventura = document.querySelector('#filmes-aventura');
let categoriaRomance = document.querySelector('#filmes-romance')
let categoriaFantasia = document.querySelector('#filmes-fantasia');
let categoriaOutros = document.querySelector('#filmes-outros');
let categoriaSugestoes = document.querySelector('#filmes-sugestoes');
let imagemPreview = document.querySelector('#preview-imagem');
let tituloDadosEl = document.querySelector('#dados-titulo');
let notaDadosEl = document.querySelector('#sessao-nota');
let resenhaDadosEl = document.querySelector('#sessao-resenha');
let categoriaDadosEl = document.querySelector('#sessao-categoria');
let imagemDadosEl = document.querySelector('#imagem-detalhes');
let imagensFilmesEl;
let botaoSalvarEl = document.querySelector('#salvar');

inputURLEl.addEventListener("change", function(){
    imagemPreview.src = inputURLEl.value;
})

$('#menu-burguer').on("click", function(){
    $('#menu').toggleClass('escondido');
});

$('#adicionar-filme').on("click", function(){
    $('#janela-adicionar-filme').toggleClass('escondido');
    $('#menu').toggleClass('escondido');
});

$('#sair-dados').on("click", function(){
    $('#dados-do-filme').addClass('escondido');
})

$('#sair-info').on("click", function(){
   $('#janela-info').toggleClass('escondido'); 
})

$('#info').on("click", function(){
    $('#janela-info').toggleClass('escondido');
    $('#menu').toggleClass('escondido');
})
let controle = localStorage.getItem('filmes');

if(controle == null){
    localStorage.setItem('filmes', JSON.stringify(vetorFilmes));
}

function ativarClicks() {
    imagensFilmesEl = document.querySelectorAll('.imagem-filme');

    imagensFilmesEl.forEach(img => {
        img.addEventListener("click", function() {
            $('#dados-do-filme').removeClass('escondido');
            let id = img.dataset.id;
            let filme = vetorFilmes.find(f => f.id == id);

            tituloDadosEl.innerHTML = filme.titulo;
            notaDadosEl.innerHTML = filme.nota;
            resenhaDadosEl.innerHTML = filme.resenha;
            imagemDadosEl.src = filme.url;
        });
    });
}


botaoSalvarEl.addEventListener("click", function(){

    

    const novoFilme = {
        id: vetorFilmes.length,
        titulo: inputNomeEl.value,
        nota: inputNotaEl.value,
        resenha: inputResenhaEl.value,
        url: inputURLEl.value,
        categoria: inputCategoriaEl.value
    };
   vetorFilmes.push(novoFilme);
    localStorage.setItem("filmes", JSON.stringify(vetorFilmes));

    salvarNoBanco(novoFilme);


    adicionaFilmesNaPagina(vetorFilmes);

    // fechar modal e limpar campos
    $('#janela-adicionar-filme').addClass('escondido');
    inputNomeEl.value = '';
    inputNotaEl.value = '';
    inputResenhaEl.value = '';
    inputURLEl.value = '';
    inputCategoriaEl.value = '';


});

function adicionaFilmesNaPagina(vetor){
    categoriaAcao.innerHTML = '';
    categoriaFantasia.innerHTML = '';
    categoriaFavoritos.innerHTML = '';
    categoriaComedia.innerHTML = '';
    categoriaRomance.innerHTML = '';
    categoriaOutros.innerHTML = '';
    categoriaSugestoes.innerHTML = '';
    categoriaAventura.innerHTML = '';

    for (let i = 0; i < vetor.length; i++) {

         let conteudo = `<img src="${vetor[i].url}" class="imagem-filme" data-id="${vetor[i].id}">`;
        let novoFilmeEl = document.createElement('article');  
        novoFilmeEl.innerHTML = conteudo;

        if(vetor[i].categoria == 'favoritos'){
            categoriaFavoritos.appendChild(novoFilmeEl);
        } else if(vetor[i].categoria == 'acao'){
            categoriaAcao.appendChild(novoFilmeEl);
        } else if(vetor[i].categoria == 'aventura'){
            categoriaAventura.appendChild(novoFilmeEl);
        } else if(vetor[i].categoria == 'comedia'){
            categoriaComedia.appendChild(novoFilmeEl);
        } else if(vetor[i].categoria == 'romance'){
            categoriaRomance.appendChild(novoFilmeEl);
        } else if(vetor[i].categoria == 'fantasia'){
            categoriaFantasia.appendChild(novoFilmeEl);
        } else if(vetor[i].categoria == 'outros'){
            categoriaOutros.appendChild(novoFilmeEl);
        } else if(vetor[i].categoria == 'sugestoes'){
            categoriaSugestoes.appendChild(novoFilmeEl);
        }
    }
    ativarClicks();
}


$('#sair').on("click", function () {
    $('#janela-adicionar-filme').toggleClass('escondido');
    inputNomeEl.value = '';
    inputNotaEl.value = '';
    inputResenhaEl.value = '';
    inputURLEl.value = '';
});


$('#salvar-lista').on("click", function () {
    localStorage.setItem('filmes', JSON.stringify(vetorFilmes));
});


function salvarNoBanco(filme) {

    $.ajax({
        url: "../PAGES/salvar.php",
        method: "POST",
        data: {
            titulo: filme.titulo,
            nota: filme.nota,
            resenha: filme.resenha,
            url: filme.url,
            categoria: filme.categoria
        },

        success: function (resposta) {
            console.log("Servidor:", resposta);
        }
    });
}


function carregarFilmes() {
    $.ajax({
        url: "../PAGES/carregar.php",
        method: "GET",
        dataType: "json",
        success: function(filmes) {

            vetorFilmes = filmes;

            adicionaFilmesNaPagina(vetorFilmes);
        }
    });
}
